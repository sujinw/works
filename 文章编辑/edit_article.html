<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="description" content="不超过150个字符"/>
    <meta name="keywords" content=""/>
    <meta name="author" content="slade, sujinw@qq.com"/>
    <!-- 为移动设备添加 viewport -->
    <meta name="viewport" content="initial-scale=1, maximum-scale=3, minimum-scale=1, user-scalable=no" />
    <!-- `width=device-width` 会导致 iPhone 5 添加到主屏后以 WebApp 全屏模式打开页面时出现黑边 http://bigc.at/ios-webapp-viewport-meta.orz -->

    <!-- iOS 设备 begin -->
    <meta name="apple-mobile-web-app-title" content="标题" />
    <!-- 添加到主屏后的标题（iOS 6 新增） -->
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <!-- 是否启用 WebApp 全屏模式，删除苹果默认的工具栏和菜单栏 -->

    <meta name="apple-itunes-app" content="app-id=myAppStoreID, affiliate-data=myAffiliateData, app-argument=myURL" />
    <!-- 添加智能 App 广告条 Smart App Banner（iOS 6+ Safari） -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <!-- 设置苹果工具栏颜色 -->
    <meta name="format-detection" content="telphone=no, email=no"/>
    <!-- 忽略页面中的数字识别为电话，忽略email识别 -->
    <!-- 启用360浏览器的极速模式(webkit) -->
    <meta name="renderer" content="webkit" />
    <!-- 避免IE使用兼容模式 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>编辑文章</title>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/weui.min.css">
    <style type="text/css">
        .m-zdbg{
              display: none;
              width: 100%;
              position: fixed;
              left: 0;
              top: 0;
              right: 0;
              bottom: 0;
              background: rgba(0,0,0,0.1);
              z-index: 110;
              overflow: hidden;
            }
        .active1{
          display: block;
        }
        .group_item .icon{color:#fff;}
    </style>
    </head>
<body style="overflow-y:scroll;">
    <div class="warrp">
        <!-- 编辑文章标题  -->
        <div class="edit-title">
            <div class="title-background">
                <div class="textarea" contenteditable='true'>编辑文章标题文章标题文章标题文章标题</div>
                <div class="changebackground">
                    <span class="icon icon-tupian" style="margin-right:10px"></span>
                    更改背景
                </div>
            </div>
            <div class="title-music">
                <div class="music-btn">
                    <span class="icon icon-music" style="margin-right: 10px"></span>
                    未设置背景音乐
                </div>
                <div class="delmusic" style="width:40px;float:left;height:30px;display:none">
                    <span class="icon icon-shanchu" style="color:#FFF;font-size:13px;"></span>
                </div>
                <div style="float:right" class="mainPic">
                    <span class="iconfont0 icon-huanyihuan" style="color:#FFF;font-size:18px;"></span>
                </div>
                <audio loop="loop" src id="media" autoplay="preload"></audio>
            </div>
            <div title="设置背景音乐" class="music" style="display:none;">
                <div class="mask_div" style="overflow-y: auto;-webkit-overflow-scrolling: touch;">
                    <div class="searchMusic">
                        <form id="musicform" onSubmit="musicsearch();return false">
                            <input type="search"  placeholder="输入关键字搜索在线音乐" id="music_keyword" maxlength="15">            
                            <div class="ok no" onClick="choose_music_ok(this)">选择这首作为背景音乐</div>
                        </form>
                    </div>
                    <div class="KeyWord_">
                        <div class="searchico_"></div>
                        搜索
                        <span id="key_word_"></span>
                    </div>
                    <div class="_list">
                        <div onClick="chooseMusic(this)" class="musiclist" data-mp3="http://www.079n.com/3294136837747241.mp3" data-name="带着梦想去旅行" data-author="庄心妍">
                            <div class="_info">
                                <div style="width:230px;text-overflow: ellipsis;display: -webkit-box;-webkit-line-clamp: 1;-webkit-box-orient: vertical;white-space:nowrap; height:20px;overflow:hide">带着梦想去旅行</div>
                                <span>庄心妍</span>
                            </div>
                        </div>
                        <div onClick="chooseMusic(this)" class="musiclist" data-mp3="http://m2.music.126.net/O7texJggO3TBhNzvnNszNw==/3294136837747241.mp3" data-name="夏洛特烦恼" data-author="金志文">
                            <div class="_info">
                                <div style="width:230px;text-overflow: ellipsis;display: -webkit-box;-webkit-line-clamp: 1;-webkit-box-orient: vertical;white-space:nowrap; height:20px;overflow:hide">夏洛特烦恼</div>
                                <span>金志文</span>
                            </div>
                        </div>
                        <div onClick="chooseMusic(this)" class="musiclist" data-mp3="http://m2.music.126.net/BzhdRzJjliLrxJ0lJBRoyw==/7972558814853034.mp3" data-name="大梦想家" data-author="TFBOYS">
                            <div class="_info">
                                <div style="width:230px;text-overflow: ellipsis;display: -webkit-box;-webkit-line-clamp: 1;-webkit-box-orient: vertical;white-space:nowrap; height:20px;overflow:hide">大梦想家</div>
                                <span>TFBOYS</span>
                            </div>
                        </div>
                        <div onClick="chooseMusic(this)" class="musiclist" data-mp3="http://m2.music.126.net/1mcydkJn4EzcruyNJGynzQ==/6044015418338974.mp3" data-name="小苹果" data-author="筷子兄弟">
                            <div class="_info">
                                <div style="width:230px;text-overflow: ellipsis;display: -webkit-box;-webkit-line-clamp: 1;-webkit-box-orient: vertical;white-space:nowrap; height:20px;overflow:hide">小苹果</div>
                                <span>筷子兄弟</span>
                            </div>
                        </div>
                        <div onClick="chooseMusic(this)" class="musiclist" data-mp3="http://m2.music.126.net/Fb72WXkpMgemAG7pU2bDzw==/5940661325305096.mp3" data-name="青春修炼手册" data-author="TFBOYS">
                            <div class="_info">
                                <div style="width:230px;text-overflow: ellipsis;display: -webkit-box;-webkit-line-clamp: 1;-webkit-box-orient: vertical;white-space:nowrap; height:20px;overflow:hide">青春修炼手册</div>
                                <span>TFBOYS</span>
                            </div>
                        </div>
                        <div onClick="chooseMusic(this)" class="musiclist" data-mp3="http://m2.music.126.net/j1NImdvTsx2o3DYbmpT9Lg==/7835119860630728.mp3" data-name="红豆" data-author="王菲">
                            <div class="_info">
                                <div style="width:230px;text-overflow: ellipsis;display: -webkit-box;-webkit-line-clamp: 1;-webkit-box-orient: vertical;white-space:nowrap; height:20px;overflow:hide">红豆</div>
                                <span>王菲</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        <!-- 编辑文章内容 -->
        <div class="edit-content" id="cont"></div>

        <!-- 发布和保存 -->
        <div class="edit-footer">
            <div class="btn_div" style="padding-top: 25px;width:260px;">
            <div class="cancle submit_btn weui_btn_plain_primary" data-save="0">保存草稿</div>
            <div class="ok submit_btn weui_btn_plain_primary" data-save="1">确定发布</div>
        </div>
        <div style="height:50px"></div>
        </div>
        <div class="template">
<script type="text" id="example_add">
    <div class="add" title="增加按钮区域">
        <span class="icon icon-add add_btn" style="color:#ddd;font-weight: bold;line-height:45px;font-size:18px" onclick="show_annu(this)">添加内容</span>
    <div class="add_btn_group">
    <div class="addico">
        <div class="addimg_btn" onclick="add_img(this)">
            <span class="icon icon-tupian " style="color:#04BE02;" ></span><br>图片</div>
        <div class="addtxt_btn" onclick="add_txt(this)">
            <span class="icon icon-wenzi14 " style="font-size:20px;color:#04BE02;font-weight: bold;"></span><br>文字</div>
        <div class="addlink_btn" onclick="add_link(this)"><span class="icon icon-lianjie " style="color:#04BE02;"></span><br>链接</div>
    </div>
</div>
</div>
</script>
<script type="text" id="example_img">
    <div class="newimg item" title="增加图片区域" data-type="img">
        <img src="$IMG$" class="upload_img no_upload_img">
        <div class="del" onclick="del(this)"><span class='icon icon-shanchu' style="display:inline-block;width:100%;height:100%;line-height:70%;text-align:center;"></span></div><div class="up" onclick="up(this)"><span class='icon icon-shangyi' style="display:inline-block;width:100%;height:100%;line-height:70%;text-align:center;"></span></div><div class="down" onclick="down(this)"><span class='icon icon-shangyi' style="display:inline-block;width:100%;height:50%;line-height:70%;text-align:center; transform:rotate(180deg);-webkit-transform:rotate(180deg)"></span></div>
    </div>
</script>
<script type="text" id="example_text">
    <div class="newtext item" title="增加文字区域" data-type="text">
        <p class="p" onclick="opentextdiv(this)" style='$textStyle$'>$text$</p>
    <div style="position:absolute;width:80px;height:80px;right:0;top:0;filter:alpha(opacity=10); -moz-opacity:0.1; -khtml-opacity: 0.1; opacity: 0.1; "><span class="iconfont0 icon-comiiswenzimoshi " style="color:#333;font-size:80px;line-height:80px"></span></div>
    <div class="del" onclick="del(this)"><span class='icon icon-shanchu' style="display:inline-block;width:100%;height:100%;line-height:70%;text-align:center;"></span></div><div class="up" onclick="up(this)"><span class='icon icon-shangyi' style="display:inline-block;width:100%;height:100%;line-height:70%;text-align:center;"></span></div><div class="down" onclick="down(this)"><span class='icon icon-shangyi' style="display:inline-block;width:100%;height:50%;line-height:70%;text-align:center; transform:rotate(180deg);-webkit-transform:rotate(180deg)"></span></div>
    </div>
</script>
<script type="text" id="example_link">
    <div class="newlink item" title="增加链接区域" data-type="link">
        <p class="p" onclick="openlinkdiv(this)"></p>
        <div style="position:absolute;width:80px;height:80px;right:0;top:0;filter:alpha(opacity=10); -moz-opacity:0.1; -khtml-opacity: 0.1; opacity: 0.1; "><span class="iconfont0 icon-wenzilianjie " style="color:#333;font-size:80px;line-height:80px"></span></div>
        <div class="del" onclick="del(this)"><span class='icon icon-shanchu' style="display:inline-block;width:100%;height:100%;line-height:70%;text-align:center;"></span></div><div class="up" onclick="up(this)"><span class='icon icon-shangyi' style="display:inline-block;width:100%;height:100%;line-height:70%;text-align:center;"></span></div><div class="down" onclick="down(this)"><span class='icon icon-shangyi' style="display:inline-block;width:100%;height:50%;line-height:70%;text-align:center; transform:rotate(180deg);-webkit-transform:rotate(180deg)"></span></div>
    </div> 
</script>
<script type="text" id="example_url_input">
    <div title="弹出链接框" class="url_input_div">
        <div class="mask_div">
            <div><br><input type="text" placeholder="添加网址(如：http://www.baidu.com)" id="url"></div><div><input type="text" placeholder="显示的文字(如：百度)" id="url_txt"></div>
            <div class="btn_div">
                <div class="cancle" onclick="cancle(this)">取消</div>
                <div class="ok" onclick="link_ok(this)">确定</div>
            </div>
        </div>
    </div>
</script>
<script type="text" id="example_txt_input">
    <div title="弹出文字输入框" class="txt_input_div" style="display:block">
        <div class="mask_div">
            <div class="input_txt_div" contenteditable="true"></div>
            <div class="toolbar">
                <dd><span ontouchstart="txt_bold(this)" class="editorfont icon-jiacu" style="font-size:20px"></span></dd>
                <dd><span ontouchstart="txt_size(this)" class="editorfont icon-zitidaxiao" ></span></dd>
                <dd><span ontouchstart="txt_align(this)" class="editorfont icon-juzhong" ></span></dd>
                <dd><span ontouchstart="txt_color(this)" class="editorfont icon-yanse" ></span></dd>
                <div class="color_group">
                    <dt ontouchstart="changeColor(this)"><span style="color:#000">■</span></dt>
                    <dt ontouchstart="changeColor(this)"><span style="color:#808080">■</span></dt>
                    <dt ontouchstart="changeColor(this)"><span style="color:#EE2207">■</span></dt>
                    <dt ontouchstart="changeColor(this)"><span style="color:#FF8900">■</span></dt>
                    <dt ontouchstart="changeColor(this)"><span style="color:#37B549">■</span></dt>
                    <dt ontouchstart="changeColor(this)"><span style="color:#157FF7">■</span></dt>
                    <dt ontouchstart="changeColor(this)"><span style="color:#B14EBB">■</span></dt>
                 </div>
            </div>
            <div class="btn_div" style="padding-top: 5px">
                <div class="cancle" onclick="cancle(this)">取消</div>
                <div class="ok" onclick="input_txt_ok(this)">确定</div>
            </div>
        </div>
    </div>
</script>
<script type="text" id="dialog_confirm">
    <div class="weui_dialog_confirm" id="dialog1">
        <div class="weui_mask"></div>
        <div class="weui_dialog">
            <div class="weui_dialog_hd"><strong class="weui_dialog_title">删除提醒</strong></div>
            <div class="weui_dialog_bd">确定删除此内容吗？</div>
            <div class="weui_dialog_ft">
                <a href="javascript:location.hash='';$('#dialog1').remove();" class="weui_btn_dialog default">取消</a>
                <a href="javascript:del_ok(this);" class="weui_btn_dialog primary">确定</a>
            </div>
        </div>
    </div>
</script>
</div>
</div>
<div id="uploadImg" style="display:none">
    <div class="upload-title">插入图片</div>
    <div class="preview-img">
        <div class="photo" id="getfile">
            <span class="icon icon-add" style='font-size: 110px;'></span>
            <img src="" alt='' id="img" />
            <input type="file" id="file" />
        </div>
        <div class="photo-txt">注：每次只能添加一张图片</div>
    </div>
    <div class="preview-btn">
        <input type="hidden" value="" id="img-id" />
        <a href="javascript:;" onclick='imgSub(this)'>确定</a>
        <a href="javascript:;">取消</a>
    </div>
</div>
<!-- //编辑器 -->
<script src="js/jquery.min.js"></script>

<script type="text/javascript">
$().ready(function(){
   var example_add = $("#example_add").html();
   $("<div>"+example_add+"</div>").appendTo("#cont");
   $(".music-btn").click(function(){
        console.log(this)
        $(".music").show(200);
   }); 
});
var example_add = $("#example_add").html();
var example_img = $("#example_img").html();
var example_text = $("#example_text").html();
var example_link = $("#example_link").html();
var example_url_input = $("#example_url_input").html(); //弹出url层
var example_txt_input = $("#example_txt_input").html(); //弹出text层
var mainpage = location.href;
var mainPic = '';
var music_temp='';
var images = {
    localId: [],
    serverId: []
  };
//重构images.localId:添加新图片，移动位置时都要更新
function getLocalId(){
    images.localId = [] ;
    var img = $(".no_upload_img");
     for (var i=0; i < img.length; i++) {
        images.localId.push( $(img[i]).attr("src") ); 
     }
}
function callTips(txt){
    $(document.body).append('<style>.new_tips{z-index:301;position:fixed;width:150px;border-radius:30px;line-height:40px;margin:0 auto;left:0;right:0;bottom:100px; background-color: rgba(0,0,0,0.7); color:#FFF;text-align:center;font-size:18px}</style><div class="new_tips">'+txt+'</div>');setTimeout(function () {$('.new_tips').remove();}, 2000);
}
function del(obj) {
    var dialog_confirm = $("#dialog_confirm").html();
    var objParentTR = $(obj).parent().parent();
    objParentTR.append(dialog_confirm); location.hash='#open';scrollAc(1);
}
function del_ok(obj){
    var src = "";
    if($('#dialog1').parent().find(".upload_img")){ //如果删除图片区域
        src = $('#dialog1').parent().find(".upload_img").attr("src");
     //如果是封面
        if($(".title").css("background").indexOf(src)>0)$(".title").css( "background",'#FFF');

        $('#dialog1').parent().remove(); location.hash='';
        getLocalId(); //重构images.localId
    }
}
function up(obj) {
    var objParentTR = $(obj).parent().parent();
    var prevTR = objParentTR.prev();
    if (prevTR.length > 0) {
        prevTR.insertAfter(objParentTR);
        $("html,body").animate({scrollTop:objParentTR.offset().top-10},1000);//1000是ms,
        getLocalId(); //重构images.localId
    } else {
        return;
    }
}
function down(obj) {
    var objParentTR = $(obj).parent().parent();
    var nextTR = objParentTR.next();
    if (nextTR.length > 0) {
        nextTR.insertBefore(objParentTR);
        $("html,body").animate({scrollTop:objParentTR.offset().top-10},1000);//1000是ms,
        getLocalId(); //重构images.localId
    } else {
        return;
    }
}
//点击添加按钮，出现三个子按钮
function show_annu(o) {
    $(o).hide();
    $(o).parent().children(".add_btn_group").show();
    menu = $(o).parent();
}
//点击添加图片框
function add_img(o){
    $("#img").attr('src','');//清空圖片標籤的src
   $("#uploadImg").show();//打開上傳遮罩
}
//获取图片
if ( typeof(FileReader) === 'undefined' ){ 
    $('.photo-txt').html("抱歉，你的浏览器不支持 FileReader，请使用现代浏览器操作！"); 
    $("#file").attr( 'disabled','disabled' ); 

} else { 
    $("#file").on( 'change',readFile );
}

//添加图片界面确定按钮
function imgSub(o){
    var imgPath = $('#img').attr('src');
    var obj=$("#cont");
    console.log(obj)
    var imghtml = example_img;
    // console.log(imgPath)
    if(imgPath == '' || imgPath == null || imgPath=='undefined')
        alert('没有选择图片！');

    var html = imghtml.replace("$IMG$", imgPath);
    var str  = "<div class='group_item'>"+ html+example_add +"</div>";
    if(imghtml!='')$(str).appendTo(obj);              
        getLocalId(); //重构images.localId

    $('#uploadImg').hide(200)
}
//========================================================
 //点击添加文本框
function add_txt(o){
    $(o).parent().parent().parent().parent().after("<div class='group_item'>"+example_text+example_add+example_txt_input+"</div>");
    location.hash="#open";
}
//点击添加文本框出现输入框
function opentextdiv(o){
    $(o).parent().parent().children(".txt_input_div").show();
    location.hash="#open";
}
 //文本框“确定”
function input_txt_ok(o){
    //判断条件
    var input_txt_div=$(o).parent().parent().children(".input_txt_div").text();
    if(input_txt_div==''){callTips("请输入文字！");return false;}
    $(".txt_input_div").hide();
    location.hash="";
    var the_txt = $(o).parent().parent().parent().parent().children(".newtext").children(".p");
    //获取样式
    var style = $(o).parent().parent().children(".input_txt_div").attr("style");
    the_txt.attr("style",style);
    the_txt.html($(o).parent().parent().children(".input_txt_div").html());
    jinzhi = 1 ;
}
//=============================================================================
//点击添加链接框
function add_link(o){
    var timestamp = Date.parse(new Date()); //时间戳
    $(o).parent().parent().parent().parent().after("<div class='group_item'>"+example_link+example_add+example_url_input+"</div>");
    location.hash="#open";
}    
//点其它地方隐藏三个子按钮
var menu = $('.add');
document.addEventListener('click',function(e) { 
   if(!(e.target == menu[0] || $.contains(menu[0], e.target))) {
        $(".add_btn_group").hide();
        $(".add_btn").show();
    }
});

//点击添加链接框出现输入链接框
function openlinkdiv(o){
    $(o).parent().parent().children(".url_input_div").show();
    location.hash="#open";scrollAc(1);
    jinzhi = 0 ;
}
//链接框“取消”
 function cancle(o){
    $(o).parent().parent().parent().hide();
    location.hash="";
    jinzhi = 1 ;
}    
//链接框“确定”
function link_ok(o){
    //判断条件
    var url=$(o).parent().parent().find("#url").val().toLowerCase();
    var url_txt=$(o).parent().parent().find("#url_txt").val();
    var reg = /^([hH][tT]{2}[pP]:\/\/|[hH][tT]{2}[pP][sS]:\/\/)+/;   
    if(!reg.test(url)){callTips("网址不正确");return false;}
    if(url_txt==''){callTips("请输入文字");return false;}
    $(o).parent().parent().parent().parent().find(".p").html("<div class='url_txt'>"+url_txt+"</div><div class='url'>"+url+"</div>");
    $(o).parent().parent().parent().hide();
    location.hash="";
    jinzhi = 1 ;
}    
function readFile(){ 
    var file = this.files[0]; 
    //这里判断下类型如果不是图片就返回 去掉就可以上传任意文件 
    if(!/image\/\w+/.test(file.type)){ 
        alert("请确保文件为图像类型"); 
        return false; 
    } 
    var reader = new FileReader(); 
    reader.readAsDataURL(file); 
    reader.onload = function(e){ 
        $('#img').attr('src',this.result); 
    } 
} 

//====================================================================
//文本框工具
    // 加粗
    function txt_bold(o){
        var bold = $(o).css("color"); 
        if(bold=='rgb(255, 102, 0)'){ //取消
            $(o).css("color","rgb(131,131,131)");
            $(o).parent().parent().parent().children('.input_txt_div').css("font-weight","normal");
        }else{ //应用
            $(o).css("color","rgb(255, 102, 0)");
             $(o).parent().parent().parent().children('.input_txt_div').css("font-weight","bold");
       }
    }   
    function txt_size(o){ //文字大小
        var ziti = $(o).css("color"); 
        if(ziti=='rgb(255, 102, 0)'){
            $(o).css("color","rgb(131,131,131)");
            $(o).parent().parent().parent().children('.input_txt_div').css("font-size","14px");
       }else{
            $(o).css("color","rgb(255, 102, 0)");
             $(o).parent().parent().parent().children('.input_txt_div').css("font-size","16px");
       }
    }
    function txt_align(o){ //文字对齐
        var center = $(o).css("color"); 
        if(center=='rgb(255, 102, 0)'){
            $(o).css("color","rgb(131,131,131)");
            $(o).parent().parent().parent().children('.input_txt_div').css("text-align","left");
        }else{
            $(o).css("color","rgb(255, 102, 0)");
            $(o).parent().parent().parent().children('.input_txt_div').css("text-align","center");
       }
    } 
    function txt_color(o){ //文字颜色
        var color = $(o).css("color"); 
        $(o).parent().parent().children(".color_group").toggle();
    } 
    function changeColor(o){ //选择文字颜色
        var color = $(o).children("span").css("color"); 
        //改变色盘的颜色
        $(o).parent().parent().find(".icon-color").css("color",color);
        $(o).parent().parent().parent().children('.input_txt_div').css("color",color);
    }
</script>
<!-- mimeditor -->
</body>
</html>